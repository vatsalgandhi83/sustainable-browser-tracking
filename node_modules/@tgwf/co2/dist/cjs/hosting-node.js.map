{
  "version": 3,
  "sources": ["../../src/hosting-node.js"],
  "sourcesContent": ["/*\n\nWe have a separate node-specific hosting.js file for node.\nThis uses the node-specific APIs for making http requests,\nand doing lookups against local JSON and sqlite databases.\nThis is used in the CommonJS build of co2.js\n\nThis lets us keep the total library small, and dependencies minimal.\n*/\n\nimport https from \"https\";\n\nimport hostingJSON from \"./hosting-json.js\";\nimport hostingJSONNode from \"./hosting-json.node.js\";\nimport { getApiRequestHeaders } from \"./helpers/index.js\";\n\n/**\n * Accept a url and perform an http request, returning the body\n * for parsing as JSON.\n *\n * @param {string} url\n * @param {string} userAgentIdentifier - Optional. The app, site, or organisation that is making the request.\n * @return {string}\n */\nasync function getBody(url, userAgentIdentifier) {\n  return new Promise(function (resolve, reject) {\n    // Do async job\n    const req = https.get(\n      url,\n      { headers: getApiRequestHeaders(userAgentIdentifier) },\n      function (res) {\n        if (res.statusCode < 200 || res.statusCode >= 300) {\n          return reject(\n            new Error(\n              `Could not get info from: ${url}. Status Code: ${res.statusCode}`\n            )\n          );\n        }\n        const data = [];\n\n        res.on(\"data\", (chunk) => {\n          data.push(chunk);\n        });\n\n        res.on(\"end\", () => resolve(Buffer.concat(data).toString()));\n      }\n    );\n    req.end();\n  });\n}\n\n/**\n * Check if a domain is hosted by a green web host.\n * @param {string|array} domain - The domain to check, or an array of domains to be checked.\n * @param {string[] | DomainCheckOptions} optionsOrDb - Optional. An object of domain check options, or a database list to use for lookups.\n * @param {string } userAgentIdentifier - Optional. The app, site, or organisation that is making the request.\n * @returns - A boolean if a string was provided, or an array of booleans if an array of domains was provided.\n *   if a string was provided for `domain`: a boolean indicating whether the domain is hosted by a green web host if `options.verbose` is false,\n *     otherwise an object representing the domain host information.\n *   if an array was provided for `domain`: an array of domains that are hosted by a green web host if `options.verbose` is false,\n *     otherwise a dictionary of domain to host information.\n */\n\nfunction check(domain, optionsOrDb, userAgentIdentifier) {\n  let db,\n    options = {};\n  if (!db && Array.isArray(optionsOrDb)) {\n    db = optionsOrDb;\n  } else {\n    options = optionsOrDb;\n    if (userAgentIdentifier) {\n      options = { ...options, userAgentIdentifier };\n    }\n    db = optionsOrDb?.db;\n  }\n\n  if (db && options?.verbose) {\n    throw new Error(\"verbose mode cannot be used with a local lookup database\");\n  }\n  if (db) {\n    return hostingJSON.check(domain, db);\n  }\n  // is it a single domain or an array of them?\n  if (typeof domain === \"string\") {\n    return checkAgainstAPI(domain, options);\n  } else {\n    return checkDomainsAgainstAPI(domain, options);\n  }\n}\n\n/**\n * Check if a domain is hosted by a green web host by querying the Green Web Foundation API.\n * @param {string} domain - The domain to check.\n * @param {DomainCheckOptions} options\n * @returns {boolean} - A boolean indicating whether the domain is hosted by a green web host if `options.verbose` is false,\n * otherwise an object representing the domain host information.\n */\nasync function checkAgainstAPI(domain, options = {}) {\n  const res = JSON.parse(\n    await getBody(\n      `https://api.thegreenwebfoundation.org/greencheck/${domain}`,\n      options.userAgentIdentifier\n    )\n  );\n  return options.verbose ? res : res.green;\n}\n\n/**\n * Check if an array of domains is hosted by a green web host by querying the Green Web Foundation API.\n * @param {array} domains - An array of domains to check.\n * @param {DomainCheckOptions} options\n * @returns {array} - An array of domains that are hosted by a green web host if `options.verbose` is false,\n * otherwise a dictionary of domain to host information.\n */\nasync function checkDomainsAgainstAPI(domains, options = {}) {\n  try {\n    const allGreenCheckResults = JSON.parse(\n      await getBody(\n        `https://api.thegreenwebfoundation.org/v2/greencheckmulti/${JSON.stringify(\n          domains\n        )}`,\n        options.userAgentIdentifier\n      )\n    );\n    return options.verbose\n      ? allGreenCheckResults\n      : hostingJSON.greenDomainsFromResults(allGreenCheckResults);\n  } catch (e) {\n    return options.verbose ? {} : [];\n  }\n}\n\nexport default {\n  check,\n  greendomains: hostingJSON.greenDomainsFromResults,\n  loadJSON: hostingJSONNode.loadJSON,\n};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA,mBAAkB;AAElB,0BAAwB;AACxB,+BAA4B;AAC5B,qBAAqC;AAUrC,eAAe,QAAQ,KAAK,qBAAqB;AAC/C,SAAO,IAAI,QAAQ,SAAU,SAAS,QAAQ;AAE5C,UAAM,MAAM,aAAAA,QAAM;AAAA,MAChB;AAAA,MACA,EAAE,aAAS,qCAAqB,mBAAmB,EAAE;AAAA,MACrD,SAAU,KAAK;AACb,YAAI,IAAI,aAAa,OAAO,IAAI,cAAc,KAAK;AACjD,iBAAO;AAAA,YACL,IAAI;AAAA,cACF,4BAA4B,GAAG,kBAAkB,IAAI,UAAU;AAAA,YACjE;AAAA,UACF;AAAA,QACF;AACA,cAAM,OAAO,CAAC;AAEd,YAAI,GAAG,QAAQ,CAAC,UAAU;AACxB,eAAK,KAAK,KAAK;AAAA,QACjB,CAAC;AAED,YAAI,GAAG,OAAO,MAAM,QAAQ,OAAO,OAAO,IAAI,EAAE,SAAS,CAAC,CAAC;AAAA,MAC7D;AAAA,IACF;AACA,QAAI,IAAI;AAAA,EACV,CAAC;AACH;AAcA,SAAS,MAAM,QAAQ,aAAa,qBAAqB;AACvD,MAAI,IACF,UAAU,CAAC;AACb,MAAI,CAAC,MAAM,MAAM,QAAQ,WAAW,GAAG;AACrC,SAAK;AAAA,EACP,OAAO;AACL,cAAU;AACV,QAAI,qBAAqB;AACvB,gBAAU,EAAE,GAAG,SAAS,oBAAoB;AAAA,IAC9C;AACA,SAAK,2CAAa;AAAA,EACpB;AAEA,MAAI,OAAM,mCAAS,UAAS;AAC1B,UAAM,IAAI,MAAM,0DAA0D;AAAA,EAC5E;AACA,MAAI,IAAI;AACN,WAAO,oBAAAC,QAAY,MAAM,QAAQ,EAAE;AAAA,EACrC;AAEA,MAAI,OAAO,WAAW,UAAU;AAC9B,WAAO,gBAAgB,QAAQ,OAAO;AAAA,EACxC,OAAO;AACL,WAAO,uBAAuB,QAAQ,OAAO;AAAA,EAC/C;AACF;AASA,eAAe,gBAAgB,QAAQ,UAAU,CAAC,GAAG;AACnD,QAAM,MAAM,KAAK;AAAA,IACf,MAAM;AAAA,MACJ,oDAAoD,MAAM;AAAA,MAC1D,QAAQ;AAAA,IACV;AAAA,EACF;AACA,SAAO,QAAQ,UAAU,MAAM,IAAI;AACrC;AASA,eAAe,uBAAuB,SAAS,UAAU,CAAC,GAAG;AAC3D,MAAI;AACF,UAAM,uBAAuB,KAAK;AAAA,MAChC,MAAM;AAAA,QACJ,4DAA4D,KAAK;AAAA,UAC/D;AAAA,QACF,CAAC;AAAA,QACD,QAAQ;AAAA,MACV;AAAA,IACF;AACA,WAAO,QAAQ,UACX,uBACA,oBAAAA,QAAY,wBAAwB,oBAAoB;AAAA,EAC9D,SAAS,GAAG;AACV,WAAO,QAAQ,UAAU,CAAC,IAAI,CAAC;AAAA,EACjC;AACF;AAEA,IAAO,uBAAQ;AAAA,EACb;AAAA,EACA,cAAc,oBAAAA,QAAY;AAAA,EAC1B,UAAU,yBAAAC,QAAgB;AAC5B;",
  "names": ["https", "hostingJSON", "hostingJSONNode"]
}
